<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Immersive World</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #87ceeb;
  font-family: sans-serif;
}

#startOverlay {
  position: fixed;
  inset: 0;
  background: #87ceeb;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  font-size: 24px;
  cursor: pointer;
  z-index: 10;
}

#debug {
  font-size: 14px;
  margin-top: 10px;
  opacity: 0.7;
}

#fade {
  position: fixed;
  inset: 0;
  background: white;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s ease;
  z-index: 9;
}
</style>
</head>

<body>

<div id="startOverlay">
  Click to Start ðŸŒž
  <div id="debug">Waiting for inputâ€¦</div>
</div>

<div id="fade"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>

<script>
/* ================= BASIC SETUP ================= */
const debug = document.getElementById("debug");
const overlay = document.getElementById("startOverlay");
const fade = document.getElementById("fade");

let started = false;

/* ================= SCENE ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(
  75, window.innerWidth / window.innerHeight, 0.1, 1000
);
camera.position.set(0, 1.6, 5);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= CONTROLS ================= */
const controls = new THREE.PointerLockControls(camera, document.body);
scene.add(controls.getObject());

/* ================= LIGHT ================= */
scene.add(new THREE.DirectionalLight(0xffffff, 1.2));
scene.add(new THREE.AmbientLight(0xffffff, 0.4));

/* ================= GROUND ================= */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(200, 200),
  new THREE.MeshStandardMaterial({ color: 0x55aa55 })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

/* ================= INPUT ================= */
const keys = {};
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

/* ================= START FUNCTION ================= */
function startWorld() {
  if (started) return;
  started = true;

  overlay.style.display = "none";
  debug.textContent = "World started";

  // Try pointer lock (may fail, but we continue anyway)
  controls.lock();
}

/* ================= CLICK / TOUCH / KEY ================= */
overlay.addEventListener("click", startWorld);
overlay.addEventListener("touchstart", startWorld);
document.addEventListener("keydown", e => {
  if (!started) startWorld();
});

/* ================= MOVEMENT ================= */
function animate() {
  requestAnimationFrame(animate);

  // MOVE EVEN IF POINTER LOCK FAILS
  const speed = 0.08;
  if (keys["KeyW"]) controls.moveForward(speed);
  if (keys["KeyS"]) controls.moveForward(-speed);
  if (keys["KeyA"]) controls.moveRight(-speed);
  if (keys["KeyD"]) controls.moveRight(speed);

  renderer.render(scene, camera);
}

animate();

/* ================= RESIZE ================= */
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
